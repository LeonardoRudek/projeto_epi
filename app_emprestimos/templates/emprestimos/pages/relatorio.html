{% extends 'base.html' %}
{% block title %}Relatório de Empréstimos{% endblock %}

{% block content %}
<div class="container my-4">

  <h2 class="mb-4 text-center">Relatório de Empréstimos</h2>

 <form method="get" class="row g-2 mb-4 align-items-end">
  <div class="col-md-3 col-sm-6">
    <label class="form-label">Nome do colaborador</label>
    <input type="text" name="colaborador_nome" value="{{ colaborador_nome }}" 
           class="form-control form-control-sm" placeholder="Ex.: Maria Souza">
  </div>

  <div class="col-md-3 col-sm-6">
    <label class="form-label">Nome do equipamento</label>
    <input type="text" name="equipamento_nome" value="{{ equipamento_nome }}" 
           class="form-control form-control-sm" placeholder="Ex.: Capacete, Luva...">
  </div>

  <div class="col-md-3 col-sm-6">
    <label class="form-label">Status</label>
    <select name="status" class="form-select form-select-sm">
      <option value="">Todos</option>
      {% for val,label in status_choices %}
        <option value="{{ val }}" {% if status_sel == val %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-3 col-sm-6">
    <label class="form-label d-block">&nbsp;</label> <!-- espaço do label -->
    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary btn-sm flex-fill">Filtrar</button>
      <a class="btn btn-light btn-sm flex-fill" href="{{ request.path }}">Limpar</a>
    </div>
  </div>
 </form>


  <div class="table-responsive shadow-sm">
    <table class="table table-striped align-middle">
      <thead class="table-light">
        <tr class="text-center">
          <th>Colaborador</th>
          <th>Matrícula</th>
          <th>EPI</th>
          <th>Entrega</th>
          <th>Prevista</th>
          <th>Devolução</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody class="text-center">
        {% for e in itens %}
          <tr>
            <td>{{ e.colaborador.nome }}</td>
            <td>{{ e.colaborador.matricula }}</td>
            <td>{{ e.epi.nome }}</td>
            <td>{{ e.data_emprestimo|date:"d/m/Y H:i" }}</td>
            <td>{% if e.data_prevista_devolucao %}{{ e.data_prevista_devolucao|date:"d/m/Y H:i" }}{% else %}-{% endif %}</td>
            <td>{% if e.data_devolucao %}{{ e.data_devolucao|date:"d/m/Y H:i" }}{% else %}-{% endif %}</td>
            <td>
              <span class="badge border
                {% if e.status == 'emprestado' %} bg-warning-subtle text-dark
                {% elif e.status == 'fornecido' %} bg-info-subtle text-dark
                {% elif e.status == 'devolvido' %} bg-success-subtle text-dark
                {% elif e.status == 'danificado' %} bg-secondary-subtle text-dark
                {% elif e.status == 'perdido' %} bg-danger-subtle text-dark
                {% else %} bg-light text-muted{% endif %}">
                {{ e.get_status_display }}
              </span>
            </td>
            <td>
              <a class="btn btn-sm btn-outline-primary"
                 href="{% url 'app_emprestimos:editar' e.id %}">
                Editar
              </a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="8" class="text-center text-muted">Nenhum registro encontrado.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
